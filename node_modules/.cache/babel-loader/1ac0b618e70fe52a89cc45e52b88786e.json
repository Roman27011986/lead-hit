{"ast":null,"code":"import { __extends } from \"tslib\";\nimport { DrawingSeries } from \"./DrawingSeries\";\nimport * as $array from \"../../../core/util/Array\";\n\nvar PolylineSeries =\n/** @class */\nfunction (_super) {\n  __extends(PolylineSeries, _super);\n\n  function PolylineSeries() {\n    var _this = _super !== null && _super.apply(this, arguments) || this; // point index in segment\n\n\n    Object.defineProperty(_this, \"_pIndex\", {\n      enumerable: true,\n      configurable: true,\n      writable: true,\n      value: 0\n    });\n    Object.defineProperty(_this, \"_tag\", {\n      enumerable: true,\n      configurable: true,\n      writable: true,\n      value: \"polyline\"\n    });\n    return _this;\n  }\n\n  Object.defineProperty(PolylineSeries.prototype, \"_handlePointerClick\", {\n    enumerable: false,\n    configurable: true,\n    writable: true,\n    value: function (event) {\n      _super.prototype._handlePointerClick.call(this, event);\n\n      if (!this._isDragging) {\n        this._isDrawing = true;\n\n        if (this._pIndex == 0) {\n          this.data.push({\n            stroke: this._getStrokeTemplate()\n          });\n\n          this._addContextInfo(this._index);\n        }\n\n        this._addPoint(event);\n      }\n    }\n  });\n  Object.defineProperty(PolylineSeries.prototype, \"_handleBulletDragStop\", {\n    enumerable: false,\n    configurable: true,\n    writable: true,\n    value: function (event) {\n      _super.prototype._handleBulletDragStop.call(this, event);\n\n      this._checkClosing(event);\n    }\n  });\n  Object.defineProperty(PolylineSeries.prototype, \"_addPoint\", {\n    enumerable: false,\n    configurable: true,\n    writable: true,\n    value: function (event) {\n      var chart = this.chart;\n\n      if (chart) {\n        var xAxis = this.get(\"xAxis\");\n        var yAxis = this.get(\"yAxis\");\n        var point = chart.plotContainer.toLocal(event.point);\n\n        var valueX = this._getXValue(xAxis.positionToValue(xAxis.coordinateToPosition(point.x)));\n\n        var valueY = this._getYValue(yAxis.positionToValue(yAxis.coordinateToPosition(point.y)));\n\n        var dataItems = this.dataItems;\n        var len = dataItems.length;\n        this.data.push({\n          valueY: valueY,\n          valueX: valueX\n        });\n        this.setPrivate(\"startIndex\", 0);\n        this.setPrivate(\"endIndex\", len);\n\n        this._addContextInfo(this._index, this._pIndex);\n\n        var dataItem = dataItems[len];\n\n        this._positionBullets(dataItem);\n\n        this._setXLocation(dataItem, valueX);\n\n        this._pIndex++;\n\n        this._handleClosing(dataItem, point);\n      }\n    }\n  });\n  Object.defineProperty(PolylineSeries.prototype, \"_checkClosing\", {\n    enumerable: false,\n    configurable: true,\n    writable: true,\n    value: function (event) {\n      var dataItem = event.target.dataItem;\n\n      if (dataItem) {\n        var sprite = event.target;\n        var point = {\n          x: sprite.x(),\n          y: sprite.y()\n        };\n\n        this._handleClosing(dataItem, point);\n      }\n    }\n  });\n  Object.defineProperty(PolylineSeries.prototype, \"_handleClosing\", {\n    enumerable: false,\n    configurable: true,\n    writable: true,\n    value: function (dataItem, point) {\n      var dataContext = dataItem.dataContext;\n\n      if (!dataContext.closing) {\n        var index = dataContext.index;\n        var firstDataItem = this._di[index][0];\n\n        if (firstDataItem && firstDataItem != dataItem) {\n          var dPoint = firstDataItem.get(\"point\");\n\n          if (dPoint) {\n            if (Math.hypot(point.x - dPoint.x, point.y - dPoint.y) < 5) {\n              dataContext.closing = firstDataItem;\n              this._pIndex = 0;\n              this._index++;\n              this.data.push({\n                stroke: this._getStrokeTemplate()\n              });\n\n              this._addContextInfo(this._index, \"e\");\n            }\n          }\n        }\n      }\n    }\n  });\n  Object.defineProperty(PolylineSeries.prototype, \"_updateElements\", {\n    enumerable: false,\n    configurable: true,\n    writable: true,\n    value: function () {\n      var _this = this;\n\n      $array.each(this.dataItems, function (dataItem) {\n        var dataContext = dataItem.dataContext;\n\n        if (dataContext) {\n          var closing = dataContext.closing;\n\n          if (closing) {\n            var valueX = closing.get(\"valueX\", 0);\n            var valueY = closing.get(\"valueY\");\n            dataItem.set(\"valueX\", valueX);\n\n            _this._setXLocation(dataItem, valueX);\n\n            dataItem.set(\"valueY\", valueY);\n            dataItem.set(\"valueYWorking\", valueY);\n\n            _this._positionBullets(dataItem);\n\n            var bullets = dataItem.bullets;\n\n            if (bullets) {\n              $array.each(bullets, function (bullet) {\n                var sprite = bullet.get(\"sprite\");\n\n                if (sprite) {\n                  sprite.set(\"forceHidden\", true);\n                }\n              });\n            }\n          }\n        }\n      });\n    }\n  });\n  Object.defineProperty(PolylineSeries, \"className\", {\n    enumerable: true,\n    configurable: true,\n    writable: true,\n    value: \"PolylineSeries\"\n  });\n  Object.defineProperty(PolylineSeries, \"classNames\", {\n    enumerable: true,\n    configurable: true,\n    writable: true,\n    value: DrawingSeries.classNames.concat([PolylineSeries.className])\n  });\n  return PolylineSeries;\n}(DrawingSeries);\n\nexport { PolylineSeries };","map":{"version":3,"mappings":";AAIA,SAASA,aAAT,QAAqG,iBAArG;AAEA,OAAO,KAAKC,MAAZ,MAAwB,0BAAxB;;AAQA;AAAA;AAAA;EAAoCC;;EAApC;IAAA,sEAQC;;;IACAC;sBAAA;wBAAA;oBAAA;aAA4B;IAA5B;IAEAA;sBAAA;wBAAA;oBAAA;aAAiB;IAAjB;;EA+GA;;;;;;WA7GA,UAA8BC,KAA9B,EAAwD;MACvDC,iBAAMC,mBAAN,CAAyBC,IAAzB,CAAyB,IAAzB,EAA0BH,KAA1B;;MAEA,IAAI,CAAC,KAAKI,WAAV,EAAuB;QACtB,KAAKC,UAAL,GAAkB,IAAlB;;QAEA,IAAI,KAAKC,OAAL,IAAgB,CAApB,EAAuB;UACtB,KAAKC,IAAL,CAAUC,IAAV,CAAe;YAAEC,MAAM,EAAE,KAAKC,kBAAL;UAAV,CAAf;;UACA,KAAKC,eAAL,CAAqB,KAAKC,MAA1B;QACA;;QAED,KAAKC,SAAL,CAAeb,KAAf;MACA;IACD;;;;;;WAED,UAAgCA,KAAhC,EAA0D;MACzDC,iBAAMa,qBAAN,CAA2BX,IAA3B,CAA2B,IAA3B,EAA4BH,KAA5B;;MACA,KAAKe,aAAL,CAAmBf,KAAnB;IACA;;;;;;WAED,UAAoBA,KAApB,EAA8C;MAC7C,IAAMgB,KAAK,GAAG,KAAKA,KAAnB;;MACA,IAAIA,KAAJ,EAAW;QACV,IAAMC,KAAK,GAAG,KAAKC,GAAL,CAAS,OAAT,CAAd;QACA,IAAMC,KAAK,GAAG,KAAKD,GAAL,CAAS,OAAT,CAAd;QAEA,IAAME,KAAK,GAAGJ,KAAK,CAACK,aAAN,CAAoBC,OAApB,CAA4BtB,KAAK,CAACoB,KAAlC,CAAd;;QAEA,IAAMG,MAAM,GAAG,KAAKC,UAAL,CAAgBP,KAAK,CAACQ,eAAN,CAAsBR,KAAK,CAACS,oBAAN,CAA2BN,KAAK,CAACO,CAAjC,CAAtB,CAAhB,CAAf;;QACA,IAAMC,MAAM,GAAG,KAAKC,UAAL,CAAgBV,KAAK,CAACM,eAAN,CAAsBN,KAAK,CAACO,oBAAN,CAA2BN,KAAK,CAACU,CAAjC,CAAtB,CAAhB,CAAf;;QAEA,IAAMC,SAAS,GAAG,KAAKA,SAAvB;QACA,IAAMC,GAAG,GAAGD,SAAS,CAACE,MAAtB;QAEA,KAAK1B,IAAL,CAAUC,IAAV,CAAe;UAAEoB,MAAM,EAAEA,MAAV;UAAkBL,MAAM,EAAEA;QAA1B,CAAf;QACA,KAAKW,UAAL,CAAgB,YAAhB,EAA8B,CAA9B;QACA,KAAKA,UAAL,CAAgB,UAAhB,EAA4BF,GAA5B;;QAEA,KAAKrB,eAAL,CAAqB,KAAKC,MAA1B,EAAkC,KAAKN,OAAvC;;QAEA,IAAM6B,QAAQ,GAAGJ,SAAS,CAACC,GAAD,CAA1B;;QACA,KAAKI,gBAAL,CAAsBD,QAAtB;;QAEA,KAAKE,aAAL,CAAmBF,QAAnB,EAA6BZ,MAA7B;;QAEA,KAAKjB,OAAL;;QACA,KAAKgC,cAAL,CAAoBH,QAApB,EAA8Bf,KAA9B;MACA;IACD;;;;;;WAED,UAAwBpB,KAAxB,EAAkD;MACjD,IAAMmC,QAAQ,GAAGnC,KAAK,CAACuC,MAAN,CAAaJ,QAA9B;;MACA,IAAIA,QAAJ,EAAc;QACb,IAAMK,MAAM,GAAGxC,KAAK,CAACuC,MAArB;QACA,IAAMnB,KAAK,GAAG;UAAEO,CAAC,EAAEa,MAAM,CAACb,CAAP,EAAL;UAAiBG,CAAC,EAAEU,MAAM,CAACV,CAAP;QAApB,CAAd;;QACA,KAAKQ,cAAL,CAAoBH,QAApB,EAA8Bf,KAA9B;MACA;IACD;;;;;;WAED,UAAyBe,QAAzB,EAAwEf,KAAxE,EAAqF;MACpF,IAAMqB,WAAW,GAAGN,QAAQ,CAACM,WAA7B;;MACA,IAAI,CAACA,WAAW,CAACC,OAAjB,EAA0B;QACzB,IAAMC,KAAK,GAAGF,WAAW,CAACE,KAA1B;QACA,IAAMC,aAAa,GAAG,KAAKC,GAAL,CAASF,KAAT,EAAgB,CAAhB,CAAtB;;QAEA,IAAIC,aAAa,IAAIA,aAAa,IAAIT,QAAtC,EAAgD;UAC/C,IAAMW,MAAM,GAAGF,aAAa,CAAC1B,GAAd,CAAkB,OAAlB,CAAf;;UACA,IAAI4B,MAAJ,EAAY;YACX,IAAIC,IAAI,CAACC,KAAL,CAAW5B,KAAK,CAACO,CAAN,GAAUmB,MAAM,CAACnB,CAA5B,EAA+BP,KAAK,CAACU,CAAN,GAAUgB,MAAM,CAAChB,CAAhD,IAAqD,CAAzD,EAA4D;cAC3DW,WAAW,CAACC,OAAZ,GAAsBE,aAAtB;cAEA,KAAKtC,OAAL,GAAe,CAAf;cACA,KAAKM,MAAL;cAEA,KAAKL,IAAL,CAAUC,IAAV,CAAe;gBAAEC,MAAM,EAAE,KAAKC,kBAAL;cAAV,CAAf;;cACA,KAAKC,eAAL,CAAqB,KAAKC,MAA1B,EAAkC,GAAlC;YACA;UACD;QACD;MACD;IACD;;;;;;WAED;MAAA;;MACCf,MAAM,CAACoD,IAAP,CAAY,KAAKlB,SAAjB,EAA4B,UAACI,QAAD,EAAS;QACpC,IAAMM,WAAW,GAAGN,QAAQ,CAACM,WAA7B;;QACA,IAAIA,WAAJ,EAAiB;UAChB,IAAMC,OAAO,GAAGD,WAAW,CAACC,OAA5B;;UACA,IAAIA,OAAJ,EAAa;YACZ,IAAMnB,MAAM,GAAGmB,OAAO,CAACxB,GAAR,CAAY,QAAZ,EAAsB,CAAtB,CAAf;YACA,IAAMU,MAAM,GAAGc,OAAO,CAACxB,GAAR,CAAY,QAAZ,CAAf;YACAiB,QAAQ,CAACe,GAAT,CAAa,QAAb,EAAuB3B,MAAvB;;YACA4B,KAAI,CAACd,aAAL,CAAmBF,QAAnB,EAA6BZ,MAA7B;;YACAY,QAAQ,CAACe,GAAT,CAAa,QAAb,EAAuBtB,MAAvB;YACAO,QAAQ,CAACe,GAAT,CAAa,eAAb,EAA8BtB,MAA9B;;YACAuB,KAAI,CAACf,gBAAL,CAAsBD,QAAtB;;YAEA,IAAMiB,OAAO,GAAGjB,QAAQ,CAACiB,OAAzB;;YACA,IAAIA,OAAJ,EAAa;cACZvD,MAAM,CAACoD,IAAP,CAAYG,OAAZ,EAAqB,UAACC,MAAD,EAAO;gBAC3B,IAAMb,MAAM,GAAGa,MAAM,CAACnC,GAAP,CAAW,QAAX,CAAf;;gBACA,IAAIsB,MAAJ,EAAY;kBACXA,MAAM,CAACU,GAAP,CAAW,aAAX,EAA0B,IAA1B;gBACA;cACD,CALD;YAMA;UACD;QACD;MACD,CAxBD;IAyBA;;EAxHDnD;oBAAA;sBAAA;kBAAA;WAAkC;EAAlC;EACAA;oBAAA;sBAAA;kBAAA;WAA0CH,aAAa,CAAC0D,UAAd,CAAyBC,MAAzB,CAAgC,CAACC,cAAc,CAACC,SAAhB,CAAhC;EAA1C;EAwHD;AAAC,CA1HD,CAAoC7D,aAApC;;SAAa4D","names":["DrawingSeries","$array","__extends","Object","event","_super","_handlePointerClick","call","_isDragging","_isDrawing","_pIndex","data","push","stroke","_getStrokeTemplate","_addContextInfo","_index","_addPoint","_handleBulletDragStop","_checkClosing","chart","xAxis","get","yAxis","point","plotContainer","toLocal","valueX","_getXValue","positionToValue","coordinateToPosition","x","valueY","_getYValue","y","dataItems","len","length","setPrivate","dataItem","_positionBullets","_setXLocation","_handleClosing","target","sprite","dataContext","closing","index","firstDataItem","_di","dPoint","Math","hypot","each","set","_this","bullets","bullet","classNames","concat","PolylineSeries","className"],"sourceRoot":"","sources":["../../../../../../src/.internal/charts/stock/drawing/PolylineSeries.ts"],"sourcesContent":["import type { ISpritePointerEvent } from \"../../../core/render/Sprite\";\r\nimport type { DataItem } from \"../../../core/render/Component\";\r\nimport type { IPoint } from \"../../../core/util/IPoint\";\r\n\r\nimport { DrawingSeries, IDrawingSeriesSettings, IDrawingSeriesPrivate, IDrawingSeriesDataItem } from \"./DrawingSeries\";\r\n\r\nimport * as $array from \"../../../core/util/Array\";\r\n\r\nexport interface IPolylineSeriesDataItem extends IDrawingSeriesDataItem { }\r\n\r\nexport interface IPolylineSeriesSettings extends IDrawingSeriesSettings { }\r\n\r\nexport interface IPolylineSeriesPrivate extends IDrawingSeriesPrivate { }\r\n\r\nexport class PolylineSeries extends DrawingSeries {\r\n\tpublic static className: string = \"PolylineSeries\";\r\n\tpublic static classNames: Array<string> = DrawingSeries.classNames.concat([PolylineSeries.className]);\r\n\r\n\tdeclare public _settings: IPolylineSeriesSettings;\r\n\tdeclare public _privateSettings: IPolylineSeriesPrivate;\r\n\tdeclare public _dataItemSettings: IPolylineSeriesDataItem;\r\n\r\n\t// point index in segment\r\n\tprotected _pIndex: number = 0;\r\n\r\n\tprotected _tag = \"polyline\";\r\n\r\n\tprotected _handlePointerClick(event: ISpritePointerEvent) {\r\n\t\tsuper._handlePointerClick(event);\r\n\r\n\t\tif (!this._isDragging) {\r\n\t\t\tthis._isDrawing = true;\r\n\r\n\t\t\tif (this._pIndex == 0) {\r\n\t\t\t\tthis.data.push({ stroke: this._getStrokeTemplate() });\r\n\t\t\t\tthis._addContextInfo(this._index);\r\n\t\t\t}\r\n\r\n\t\t\tthis._addPoint(event);\r\n\t\t}\r\n\t}\r\n\r\n\tprotected _handleBulletDragStop(event: ISpritePointerEvent) {\r\n\t\tsuper._handleBulletDragStop(event);\r\n\t\tthis._checkClosing(event);\r\n\t}\r\n\r\n\tprotected _addPoint(event: ISpritePointerEvent) {\r\n\t\tconst chart = this.chart;\r\n\t\tif (chart) {\r\n\t\t\tconst xAxis = this.get(\"xAxis\");\r\n\t\t\tconst yAxis = this.get(\"yAxis\");\r\n\r\n\t\t\tconst point = chart.plotContainer.toLocal(event.point);\r\n\r\n\t\t\tconst valueX = this._getXValue(xAxis.positionToValue(xAxis.coordinateToPosition(point.x)));\r\n\t\t\tconst valueY = this._getYValue(yAxis.positionToValue(yAxis.coordinateToPosition(point.y)));\r\n\r\n\t\t\tconst dataItems = this.dataItems;\r\n\t\t\tconst len = dataItems.length;\r\n\r\n\t\t\tthis.data.push({ valueY: valueY, valueX: valueX });\r\n\t\t\tthis.setPrivate(\"startIndex\", 0);\r\n\t\t\tthis.setPrivate(\"endIndex\", len);\r\n\r\n\t\t\tthis._addContextInfo(this._index, this._pIndex);\r\n\r\n\t\t\tconst dataItem = dataItems[len];\r\n\t\t\tthis._positionBullets(dataItem);\r\n\r\n\t\t\tthis._setXLocation(dataItem, valueX);\r\n\r\n\t\t\tthis._pIndex++;\r\n\t\t\tthis._handleClosing(dataItem, point);\r\n\t\t}\r\n\t}\r\n\r\n\tprotected _checkClosing(event: ISpritePointerEvent) {\r\n\t\tconst dataItem = event.target.dataItem;\r\n\t\tif (dataItem) {\r\n\t\t\tconst sprite = event.target;\r\n\t\t\tconst point = { x: sprite.x(), y: sprite.y() }\r\n\t\t\tthis._handleClosing(dataItem, point);\r\n\t\t}\r\n\t}\r\n\r\n\tprotected _handleClosing(dataItem: DataItem<this[\"_dataItemSettings\"]>, point: IPoint) {\r\n\t\tconst dataContext = dataItem.dataContext as any;\r\n\t\tif (!dataContext.closing) {\r\n\t\t\tconst index = dataContext.index;\r\n\t\t\tconst firstDataItem = this._di[index][0];\r\n\r\n\t\t\tif (firstDataItem && firstDataItem != dataItem) {\r\n\t\t\t\tconst dPoint = firstDataItem.get(\"point\");\r\n\t\t\t\tif (dPoint) {\r\n\t\t\t\t\tif (Math.hypot(point.x - dPoint.x, point.y - dPoint.y) < 5) {\r\n\t\t\t\t\t\tdataContext.closing = firstDataItem;\r\n\r\n\t\t\t\t\t\tthis._pIndex = 0;\r\n\t\t\t\t\t\tthis._index++;\r\n\r\n\t\t\t\t\t\tthis.data.push({ stroke: this._getStrokeTemplate() });\r\n\t\t\t\t\t\tthis._addContextInfo(this._index, \"e\");\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tprotected _updateElements() {\r\n\t\t$array.each(this.dataItems, (dataItem) => {\r\n\t\t\tconst dataContext = dataItem.dataContext as any;\r\n\t\t\tif (dataContext) {\r\n\t\t\t\tconst closing = dataContext.closing;\r\n\t\t\t\tif (closing) {\r\n\t\t\t\t\tconst valueX = closing.get(\"valueX\", 0);\r\n\t\t\t\t\tconst valueY = closing.get(\"valueY\");\r\n\t\t\t\t\tdataItem.set(\"valueX\", valueX);\r\n\t\t\t\t\tthis._setXLocation(dataItem, valueX);\r\n\t\t\t\t\tdataItem.set(\"valueY\", valueY);\r\n\t\t\t\t\tdataItem.set(\"valueYWorking\", valueY);\r\n\t\t\t\t\tthis._positionBullets(dataItem);\r\n\r\n\t\t\t\t\tconst bullets = dataItem.bullets;\r\n\t\t\t\t\tif (bullets) {\r\n\t\t\t\t\t\t$array.each(bullets, (bullet) => {\r\n\t\t\t\t\t\t\tconst sprite = bullet.get(\"sprite\");\r\n\t\t\t\t\t\t\tif (sprite) {\r\n\t\t\t\t\t\t\t\tsprite.set(\"forceHidden\", true);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t})\r\n\t}\r\n}"]},"metadata":{},"sourceType":"module"}
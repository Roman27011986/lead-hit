{"ast":null,"code":"import { __extends } from \"tslib\";\nimport { ChartIndicator } from \"./ChartIndicator\";\nimport { LineSeries } from \"../../xy/series/LineSeries\";\nimport * as $array from \"../../../core/util/Array\";\n/**\r\n * An implementation of a [[StockChart]] indicator.\r\n *\r\n * @see {@link https://www.amcharts.com/docs/v5/charts/stock/indicators/} for more info\r\n */\n\nvar ChaikinOscillator =\n/** @class */\nfunction (_super) {\n  __extends(ChaikinOscillator, _super);\n\n  function ChaikinOscillator() {\n    var _this = _super !== null && _super.apply(this, arguments) || this;\n\n    Object.defineProperty(_this, \"_editableSettings\", {\n      enumerable: true,\n      configurable: true,\n      writable: true,\n      value: [{\n        key: \"period\",\n        name: _this.root.language.translateAny(\"Fast period\"),\n        type: \"number\"\n      }, {\n        key: \"slowPeriod\",\n        name: _this.root.language.translateAny(\"Slow period\"),\n        type: \"number\"\n      }, {\n        key: \"seriesColor\",\n        name: _this.root.language.translateAny(\"Color\"),\n        type: \"color\"\n      }]\n    });\n    Object.defineProperty(_this, \"_themeTag\", {\n      enumerable: true,\n      configurable: true,\n      writable: true,\n      value: \"chaikinoscillator\"\n    });\n    return _this;\n  }\n\n  Object.defineProperty(ChaikinOscillator.prototype, \"_createSeries\", {\n    enumerable: false,\n    configurable: true,\n    writable: true,\n    value: function () {\n      return this.panel.series.push(LineSeries.new(this._root, {\n        xAxis: this.xAxis,\n        yAxis: this.yAxis,\n        valueXField: \"valueX\",\n        valueYField: \"cmf\",\n        stroke: this.get(\"seriesColor\"),\n        fill: undefined\n      }));\n    }\n  });\n  Object.defineProperty(ChaikinOscillator.prototype, \"_prepareChildren\", {\n    enumerable: false,\n    configurable: true,\n    writable: true,\n    value: function () {\n      if (this.isDirty(\"volumeSeries\") || this.isDirty(\"slowPeriod\")) {\n        this._dataDirty = true;\n        this.setCustomData(\"slowPeriod\", this.get(\"slowPeriod\"));\n      }\n\n      _super.prototype._prepareChildren.call(this);\n    }\n  });\n  /**\r\n   * @ignore\r\n   */\n\n  Object.defineProperty(ChaikinOscillator.prototype, \"prepareData\", {\n    enumerable: false,\n    configurable: true,\n    writable: true,\n    value: function () {\n      if (this.series) {\n        var dataItems = this.get(\"stockSeries\").dataItems;\n        var volumeSeries_1 = this.get(\"volumeSeries\");\n        this.setRaw(\"field\", \"close\");\n        var i_1 = 0;\n\n        var data_1 = this._getDataArray(dataItems);\n\n        var prevAD_1 = 0;\n        $array.each(dataItems, function (dataItem) {\n          var close = dataItem.get(\"valueY\");\n\n          if (close != null) {\n            var low = dataItem.get(\"lowValueY\", close);\n            var high = dataItem.get(\"highValueY\", close);\n            var volume = 1;\n            var volumeDI = volumeSeries_1.dataItems[i_1];\n\n            if (volumeDI) {\n              volume = volumeDI.get(\"valueY\", 1);\n            }\n\n            var mf = (close - low - (high - close)) / (high - low);\n\n            if (high == low) {\n              mf = 0;\n            }\n\n            var ad = prevAD_1 + mf * volume;\n            data_1[i_1].ad = ad;\n            prevAD_1 = ad;\n          }\n\n          i_1++;\n        });\n\n        this._ema(data_1, this.get(\"slowPeriod\", 10), \"ad\", \"emaSlow\");\n\n        this._ema(data_1, this.get(\"period\", 3), \"ad\", \"emaFast\");\n\n        $array.each(data_1, function (dataItem) {\n          var emaSlow = dataItem.emaSlow;\n          var emaFast = dataItem.emaFast;\n\n          if (emaSlow != null && emaFast != null) {\n            dataItem.cmf = emaFast - emaSlow;\n          }\n        });\n        this.series.data.setAll(data_1);\n      }\n    }\n  });\n  Object.defineProperty(ChaikinOscillator, \"className\", {\n    enumerable: true,\n    configurable: true,\n    writable: true,\n    value: \"ChaikinOscillator\"\n  });\n  Object.defineProperty(ChaikinOscillator, \"classNames\", {\n    enumerable: true,\n    configurable: true,\n    writable: true,\n    value: ChartIndicator.classNames.concat([ChaikinOscillator.className])\n  });\n  return ChaikinOscillator;\n}(ChartIndicator);\n\nexport { ChaikinOscillator };","map":{"version":3,"mappings":"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","names":["ChartIndicator","LineSeries","$array","__extends","Object","key","name","_this","root","language","translateAny","type","panel","series","push","new","_root","xAxis","yAxis","valueXField","valueYField","stroke","get","fill","undefined","isDirty","_dataDirty","setCustomData","_super","_prepareChildren","call","dataItems","volumeSeries_1","setRaw","i_1","data_1","_getDataArray","prevAD_1","each","dataItem","close","low","high","volume","volumeDI","mf","ad","_ema","emaSlow","emaFast","cmf","data","setAll","classNames","concat","ChaikinOscillator","className"],"sourceRoot":"","sources":["../../../../../../src/.internal/charts/stock/indicators/ChaikinOscillator.ts"],"sourcesContent":["import type { IIndicatorEditableSetting } from \"./Indicator\";\r\nimport type { XYSeries } from \"../../xy/series/XYSeries\";\r\n\r\nimport { ChartIndicator, IChartIndicatorSettings, IChartIndicatorPrivate, IChartIndicatorEvents } from \"./ChartIndicator\";\r\nimport { LineSeries } from \"../../xy/series/LineSeries\";\r\n\r\nimport * as $array from \"../../../core/util/Array\";\r\n\r\nexport interface IChaikinOscillatorSettings extends IChartIndicatorSettings {\r\n\r\n\t/**\r\n\t * Main volume series of the [[StockChart]].\r\n\t */\r\n\tvolumeSeries: XYSeries;\r\n\r\n\t/**\r\n\t * Slow period setting.\r\n\t */\r\n\tslowPeriod?: number;\r\n\r\n}\r\n\r\nexport interface IChaikinOscillatorPrivate extends IChartIndicatorPrivate {\r\n}\r\n\r\nexport interface IChaikinOscillatorEvents extends IChartIndicatorEvents {\r\n}\r\n\r\n\r\n/**\r\n * An implementation of a [[StockChart]] indicator.\r\n *\r\n * @see {@link https://www.amcharts.com/docs/v5/charts/stock/indicators/} for more info\r\n */\r\nexport class ChaikinOscillator extends ChartIndicator {\r\n\tpublic static className: string = \"ChaikinOscillator\";\r\n\tpublic static classNames: Array<string> = ChartIndicator.classNames.concat([ChaikinOscillator.className]);\r\n\r\n\tdeclare public _settings: IChaikinOscillatorSettings;\r\n\tdeclare public _privateSettings: IChaikinOscillatorPrivate;\r\n\tdeclare public _events: IChaikinOscillatorEvents;\r\n\r\n\t/**\r\n\t * Indicator series.\r\n\t */\r\n\tdeclare public series: LineSeries;\r\n\r\n\tpublic _editableSettings: IIndicatorEditableSetting[] = [{\r\n\t\tkey: \"period\",\r\n\t\tname: this.root.language.translateAny(\"Fast period\"),\r\n\t\ttype: \"number\"\r\n\t}, {\r\n\t\tkey: \"slowPeriod\",\r\n\t\tname: this.root.language.translateAny(\"Slow period\"),\r\n\t\ttype: \"number\"\r\n\t}, {\r\n\t\tkey: \"seriesColor\",\r\n\t\tname: this.root.language.translateAny(\"Color\"),\r\n\t\ttype: \"color\"\r\n\t}];\r\n\r\n\tprotected _themeTag: string = \"chaikinoscillator\";\r\n\r\n\tpublic _createSeries(): LineSeries {\r\n\t\treturn this.panel.series.push(LineSeries.new(this._root, {\r\n\t\t\txAxis: this.xAxis,\r\n\t\t\tyAxis: this.yAxis,\r\n\t\t\tvalueXField: \"valueX\",\r\n\t\t\tvalueYField: \"cmf\",\r\n\t\t\tstroke: this.get(\"seriesColor\"),\r\n\t\t\tfill: undefined\r\n\t\t}))\r\n\t}\r\n\r\n\tpublic _prepareChildren() {\r\n\t\tif (this.isDirty(\"volumeSeries\") || this.isDirty(\"slowPeriod\")) {\r\n\t\t\tthis._dataDirty = true;\r\n\t\t\tthis.setCustomData(\"slowPeriod\", this.get(\"slowPeriod\"));\r\n\t\t}\r\n\t\tsuper._prepareChildren();\r\n\t}\r\n\r\n\t/**\r\n\t * @ignore\r\n\t */\r\n\tpublic prepareData() {\r\n\t\tif (this.series) {\r\n\r\n\t\t\tconst dataItems = this.get(\"stockSeries\").dataItems;\r\n\t\t\tconst volumeSeries = this.get(\"volumeSeries\");\r\n\t\t\tthis.setRaw(\"field\", \"close\");\r\n\r\n\t\t\tlet i = 0;\r\n\t\t\tlet data: Array<any> = this._getDataArray(dataItems);\r\n\t\t\tlet prevAD = 0;\r\n\r\n\t\t\t$array.each(dataItems, (dataItem) => {\r\n\t\t\t\tlet close = dataItem.get(\"valueY\") as number;\r\n\t\t\t\tif (close != null) {\r\n\t\t\t\t\tlet low = dataItem.get(\"lowValueY\", close) as number;\r\n\t\t\t\t\tlet high = dataItem.get(\"highValueY\", close) as number;\r\n\r\n\t\t\t\t\tlet volume = 1;\r\n\r\n\t\t\t\t\tconst volumeDI = volumeSeries.dataItems[i];\r\n\t\t\t\t\tif (volumeDI) {\r\n\t\t\t\t\t\tvolume = volumeDI.get(\"valueY\", 1);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tlet mf = ((close - low) - (high - close)) / (high - low)\r\n\t\t\t\t\tif (high == low) {\r\n\t\t\t\t\t\tmf = 0;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tlet ad = prevAD + mf * volume;\r\n\t\t\t\t\tdata[i].ad = ad;\r\n\r\n\t\t\t\t\tprevAD = ad\r\n\t\t\t\t}\r\n\t\t\t\ti++;\r\n\t\t\t})\r\n\r\n\t\t\tthis._ema(data, this.get(\"slowPeriod\", 10), \"ad\", \"emaSlow\");\r\n\t\t\tthis._ema(data, this.get(\"period\", 3), \"ad\", \"emaFast\");\r\n\r\n\t\t\t$array.each(data, (dataItem) => {\r\n\t\t\t\tconst emaSlow = dataItem.emaSlow;\r\n\t\t\t\tconst emaFast = dataItem.emaFast;\r\n\t\t\t\tif (emaSlow != null && emaFast != null) {\r\n\t\t\t\t\tdataItem.cmf = emaFast - emaSlow;\r\n\t\t\t\t}\r\n\t\t\t})\r\n\r\n\t\t\tthis.series.data.setAll(data);\r\n\t\t}\r\n\t}\r\n}"]},"metadata":{},"sourceType":"module"}